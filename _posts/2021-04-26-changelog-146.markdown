---
layout: post
title: "IntelliJ Rust Changelog #146"
date: 2021-04-26 17:00:00 +0300
---


## New Features

* Provide initial support for [custom derive](https://doc.rust-lang.org/reference/procedural-macros.html#derive-macros)
  procedural macros. Now the plugin can expand such procedural macro calls and take into account expanded `impl` items
  in type inference and name resolution (other types of items are ignored).

  Note, it’s only an initial implementation,
  so it may work in an unexpected way in some cases. The feature is disabled by default for now.To turn it on, you
  should enable `Use experimental name resolution engine` option in `Preferences | Languages & Frameworks | Rust`
  settings and enable `org.rust.cargo.evaluate.build.scripts` and `org.rust.macros.proc` experimental features
  (see instructions [here][experimental features]).
  Don’t forget to reload a project structure after enabling the corresponding features via `Refresh Cargo Projects`
  action on Cargo tool window. See [tracking issue](https://github.com/intellij-rust/intellij-rust/issues/6908) for
  more details and the current status of procedural macros support

  {% include gif-img.html path="/assets/posts/changelog-146/custom-derive" w="600px" %}
  <!-- https://github.com/intellij-rust/intellij-rust/pull/6992 -->

* Now the plugin takes [Cargo config](https://doc.rust-lang.org/cargo/reference/config.html) into account during
  evaluation of `cfg` conditions. Note, it works since Rust 1.52.0

  {% include gif-img.html path="/assets/posts/changelog-146/cfg-cargo-config" w="600px" %}
  <!-- https://github.com/intellij-rust/intellij-rust/pull/7093 -->

* Add intention that toggles feature state from a cfg attribute (by [@Kobzol])

  {% include gif-img.html path="/assets/posts/changelog-146/intention-cargo-feature" w="600px" %}
  <!-- https://github.com/intellij-rust/intellij-rust/pull/6845 -->
  <!-- https://github.com/intellij-rust/intellij-rust/pull/7115 -->

* provide `Share in Playground` intention to share selected Rust code on [Rust Playground](https://play.rust-lang.org)

  {% include gif-img.html path="/assets/posts/changelog-146/intention-playground" w="600px" %}
  <!-- https://github.com/intellij-rust/intellij-rust/pull/7071 -->

* Improve code folding:
  * Support for `imports` and `method bodies` options in `Code Folding - General` settings (by [@Stzx])
    <!-- https://github.com/intellij-rust/intellij-rust/pull/7112 -->

    TODO gif

  * Support fold `where` (by [@Stzx])

    {% include gif-img.html path="/assets/posts/changelog-146/fold-where" w="600px" %}
    <!-- https://github.com/intellij-rust/intellij-rust/pull/7111 -->

* Add intention to expand dependency specification in `Cargo.toml`

  {% include gif-img.html path="/assets/posts/changelog-146/intention-expand-dependency" w="600px" %}
  <!-- https://github.com/intellij-rust/intellij-rust/pull/6960 -->

* Add an intention to create a struct from an unresolved struct literal usage. (by [@Kobzol])

  {% include gif-img.html path="/assets/posts/changelog-146/intention-struct" w="600px" %}
  <!-- https://github.com/intellij-rust/intellij-rust/pull/6837 -->

* Improve experimental crate-local index (TODO note about experimental feature):
  * Add inspection that checks crate dependency version requirements in Cargo.toml that do not match any known crate version. (by [@Kobzol])
    <!-- https://github.com/intellij-rust/intellij-rust/pull/6801 -->
  * Use semantic versioning to improve version sorting in dependencies when using experimental local crates index
    <!-- https://github.com/intellij-rust/intellij-rust/pull/6599 -->

* Drop support of `org.rust.cargo.evaluate.build.scripts` experimental feature.
  Use `org.rust.cargo.evaluate.build.scripts` instead if you need to evaluate
  `env!("OUT_DIR")` in your `include!` macro calls
  <!-- https://github.com/intellij-rust/intellij-rust/pull/7142 -->

<!-- https://github.com/intellij-rust/intellij-rust/pull/6581 -->
<!-- * Introduce navigation bar breadcrumbs. (by [@Kobzol]) -->
<!-- disabled in https://github.com/intellij-rust/intellij-rust/pull/7154 -->

## Fixes

* INT: replace usages in DestructureIntention (by [@Kobzol])

  {% include gif-img.html path="/assets/posts/changelog-146/intention-destructure-decl" w="600px" %}
  <!-- https://github.com/intellij-rust/intellij-rust/pull/5650 -->

* Allow explicitly stating the function return type in CreateFunctionIntention if the inferred return type was unknown. (by [@Kobzol])

  {% include gif-img.html path="/assets/posts/changelog-146/intention-create-function" w="600px" %}
  <!-- https://github.com/intellij-rust/intellij-rust/pull/6986 -->

* Don't run inspections on files outside a valid project
  <!-- https://github.com/intellij-rust/intellij-rust/pull/6013 -->

* FMT: add line break after opening brace in struct blocks (by [@Kobzol])
  <!-- https://github.com/intellij-rust/intellij-rust/pull/5491 -->

* fix name resolution of field shorthand to a local variable in the case of unresolved struct literal
  <!-- https://github.com/intellij-rust/intellij-rust/pull/7132 -->

* Fix false-positive proofreading warnings for sentences written in several sequential Rust comments.
  Note, you can enable/disable proofreading in Rust files in `Preferences | Editor | Proofreading | Grammar` settings
  <!-- https://github.com/intellij-rust/intellij-rust/pull/7131 -->

* Refresh Cargo project when workspace `Cargo.toml` is changed
  <!-- https://github.com/intellij-rust/intellij-rust/pull/7121 -->

* correctly resolve qualified attribute proc macro paths (like `#[foo::bar]`)
  <!-- https://github.com/intellij-rust/intellij-rust/pull/7119 -->

* Fix auto import in the case of a renamed cargo package
  <!-- https://github.com/intellij-rust/intellij-rust/pull/7108 -->

* Remove false positive in RsNeedlessLifetimesInspection when the lifetime is used in where clause. (by [@Kobzol])
  <!-- https://github.com/intellij-rust/intellij-rust/pull/7101 -->

* Fix resolve of macros with absolute paths with new name resolution engine
  <!-- https://github.com/intellij-rust/intellij-rust/pull/7089 -->

* Fix some false positives in name conflict detection in ChangeSignature refactoring. (by [@Kobzol])
  <!-- https://github.com/intellij-rust/intellij-rust/pull/7081 -->

* Do not needlessly import default type arguments in ChangeSignature refactoring (by [@Kobzol])
  <!-- https://github.com/intellij-rust/intellij-rust/pull/7080 -->

* MACRO: fix expansion if proc macro is added as separate cargo project
  <!-- https://github.com/intellij-rust/intellij-rust/pull/7079 -->

* Correctly place function visibility after attributes in Change signature refactoring. (by [@Kobzol])
  <!-- https://github.com/intellij-rust/intellij-rust/pull/7076 -->

* place `Show the result of macro expansion` intention lower in the intention list
  <!-- https://github.com/intellij-rust/intellij-rust/pull/7072 -->

* ANN: If no `crate` exists, no check is performed (by [@Stzx])
  <!-- https://github.com/intellij-rust/intellij-rust/pull/7070 -->

* Exclude some cfg-disabled items from completion when using new name resolution engine
  <!-- https://github.com/intellij-rust/intellij-rust/pull/7057 -->

* INSP&COMP: Use exceptions to check whether index is updating
  <!-- https://github.com/intellij-rust/intellij-rust/pull/7004 -->

* Fix `Can't find process starter` error when running DTrace profiler with CLion 2021.1
  <!-- https://github.com/intellij-rust/intellij-rust/pull/7150 -->

* Deduplicate cargo projects
  <!-- https://github.com/intellij-rust/intellij-rust/pull/6201 -->

## Internal Improvements

* Don't show "Tip of the Day" at startup in internal IDEs
  <!-- https://github.com/intellij-rust/intellij-rust/pull/7114 -->

* Enable Gradle Build Cache (see [#7094](https://github.com/intellij-rust/intellij-rust/pull/7094)) for more info
  <!-- https://github.com/intellij-rust/intellij-rust/pull/7094 -->

* Introduce `2021` edition variant in the plugin and adjust the corresponding code
  <!-- https://github.com/intellij-rust/intellij-rust/pull/6903 -->

* Implement stub-only `QueryAttributes` API
  <!-- https://github.com/intellij-rust/intellij-rust/pull/7046 -->

Full set of changes can be found [here](https://github.com/intellij-rust/intellij-rust/milestone/54?closed=1)

[@Kobzol]: https://github.com/Kobzol
[@Stzx]: https://github.com/Stzx
[@abn]: https://github.com/abn

[experimental features]: https://plugins.jetbrains.com/plugin/8182-rust/docs/rust-faq.html#experimental-features
